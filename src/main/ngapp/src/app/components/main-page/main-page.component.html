<app-header></app-header>

<div class="container-fluid pt-2 pb-4" style="background-color: #f5f7f8">

    <div class="float-right">
        <div class="btn-group pr-3">
            <small ngbDropdown>
                <span class="text-muted">Sort by:</span>&nbsp;
                <span ngbDropdownToggle class="cursor-pointer">
                    <i class="fa" [ngClass]="{'fa-long-arrow-up': params.asc, 'fa-long-arrow-down': !params.asc}"></i>
                    <span *ngIf="params.sort == 'id'"> Last Updated</span>
                    <span *ngIf="params.sort == 'taxonomy'"> Phylum</span>
                    <span *ngIf="params.sort == 'name'"> Name</span>
                    <span *ngIf="params.sort == 'tier'"> Tier</span>

                     <ul ngbDropdownMenu class="dropdown-menu p-1">
                         <li ngbDropdownItem class="small pl-2" (click)="sort('name')">Name</li>
                         <li ngbDropdownItem class="small pl-2" (click)="sort('taxonomy')">Phylum</li>
                         <li ngbDropdownItem class="small pl-2" (click)="sort('id')">Last Update</li>
                         <li ngbDropdownItem class="small pl-2" (click)="sort('tier')">Tier</li>
                     </ul>
                </span>
            </small>
        </div>

        <div class="btn-group">
            <button class="btn" [ngClass]="{'border bg-white pt-1 pb-1 pr-2 pl-2': gridMode}" (click)="gridMode = true">
                <i class="fa fa-th"></i>
            </button>
            <button class="btn" [ngClass]="{'border bg-white pt-1 pb-1 pr-2 pl-2': !gridMode}"
                    (click)="gridMode = false"><i class="fa fa-bars"></i>
            </button>
        </div>
    </div>

    <br>

    <table class="table table-bordered table-hover table-responsive-lg bg-white" *ngIf="!gridMode">
        <thead>
        <tr class="text-uppercase" style="font-size: 12px">
            <th>Host</th>
            <th>Taxonomy</th>
            <th>Tier</th>
            <th>Created</th>
            <th>Updated</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let host of hosts">
            <td class="text-primary">{{ host.name }}</td>
            <td class="font-italic text-muted">{{ host.phylum }}</td>
            <td>
                <span *ngIf="!host.tier" class="badge p-2 pr-3 pl-3 badge-secondary">Tier 0</span>
                <span *ngIf="host.tier" style="font-size: 14px" class="p-2 pr-3 pl-3 badge" [ngClass]="{'badge-secondary': (host.tier.index === 0 || host.tier === undefined),
                    'badge-primary': host.tier.index === 1, 'badge-info': host.tier.index === 2, 'badge-success': host.tier.index === 3}">Tier {{ host.tier.index || '1' }}</span>
            </td>
            <td>{{ host.created | date }}</td>
            <td><span *ngIf="host.updated">{{ host.updated | date }}</span></td>
        </tr>
        </tbody>
    </table>

    <div class="row mt-3" *ngIf="gridMode">
        <div class="card ml-4 mb-4 shadow-sm" style="width: 28rem" *ngFor="let host of hosts">
            <div class="card-body pb-1">
                <h5 class="card-title">
                    <span class="cursor-pointer" (click)="goToHost(host)">{{ host.name }}</span>
                    <span *ngIf="!host.tier" class="float-right badge p-2 pr-3 pl-3 badge-secondary">Tier 0</span>
                    <span *ngIf="host.tier" style="font-size: 14px" class="p-2 pr-3 pl-3 float-right badge" [ngClass]="{'badge-secondary': host.tier.index === 0,
                    'badge-primary': host.tier.index === 1, 'badge-info': host.tier.index === 2, 'badge-success': host.tier.index === 3}">{{ host.tier.label }}</span>


                    <!--                    <span style="font-size: 14px" class="p-2 float-right badge" [ngClass]="{'badge-secondary': (host.tier === 1 || !host.tier),-->
                    <!--                    'badge-primary': host.tier === 2, 'badge-info': host.tier === 3, 'badge-success': host.tier === 4}">Tier {{ host.tier || '1' }}</span>-->
                </h5>
                <h6 class="card-subtitle mb-2 text-muted font-italic">{{ host.phylum }}</h6>
                <p class="card-text pt-3 border-top">
                    <b class="text-primary">{{ host.publications || 0 }}</b> publications<br>
                    <b class="text-primary">{{ host.parts || 0 }}</b> associated parts<br>
                    <b class="text-primary">{{ host.experiments || 0}}</b> experiments<br>
                    <b class="text-primary">{{ host.protocols || 0 }}</b> protocols<br>
                </p>

                <p *ngIf="host.updated" class="small float-left text-muted">Last update: {{ host.updated | date }}</p>
                <a routerLink="/host/{{ host.id }}" class="card-link float-right small">details &raquo;</a>
            </div>
        </div>

        <div class="card ml-4 mb-4 border-0 shadow-sm opacity-hover" style="width: 28rem"
             (click)="showCreateOrganism()" *ngIf="!showCreateNewHost && canCreateNewHost()">
            <div class="card-body pb-1 text-center">
                <i class="fa fa-fw fa-plus text-success" style="font-size: 120px"></i>
                <br>
                <h5>Add new organism</h5>
            </div>
        </div>

        <div class="card ml-4 mb-4 border-0 shadow-sm" style="width: 28rem" *ngIf="showCreateNewHost">
            <div class="card-body pb-1">
                <form (submit)="createOrganism()" id="createOrganismForm">
                    <h5 class="border-bottom">Create new organism</h5>

                    <div class="row mb-1">
                        <div class="col-sm-5 offset-7">
                            <span *ngIf="!availableTiers"
                                  class="float-right badge p-2 pr-3 pl-3 badge-secondary">Tier 0</span>

                            <select class="form-control float-right" id="tier" name="hostTierSelect"
                                    *ngIf="availableTiers && availableTiers.length" [(ngModel)]="newHost.tier">
                                <option [ngValue]="undefined">Tier 0</option>
                                <option [ngValue]="tier" *ngFor="let tier of availableTiers">{{tier.label}}</option>
                            </select>
                        </div>
                    </div>

                    <input name="hostName" class="form-control" [(ngModel)]="newHost.name" placeholder="Enter name">
                    <input name="hostPhylum" class="form-control mt-1" [(ngModel)]="newHost.phylum"
                           placeholder="Enter phylum">
                    <div class="m-2 pull-right">
                        <button class="btn btn-link" (click)="showCreateNewHost = false">Cancel</button>
                        <button class="btn btn-sm btn-primary" type="submit"
                                [disabled]="!newHost.name || !newHost.phylum">Create
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>

<app-footer></app-footer>
